project:
  type: book
  output-dir: docs

book:
  title: "Manutenção e Confiabilidade: Aplicação em R"
  subtitle: "Aplicações em R"
  author:
    - name: "Rafael da Silva Fernandes"
      affiliation: "Universidade Federal de Itajubá"
  date: today
  sidebar:
    style: docked
    collapse-level: 3
    search: true

  chapters:
    - index.qmd
    - preface.qmd
    - requirements.qmd
    - setup.qmd

    - part: "Medidas de Performance na Mineração"
      chapters:
        - chapters/part1-01-ciclo-carregamento-transporte.qmd
        - chapters/part1-02-analise-dados-recorrentes.qmd
        - chapters/part1-03-aplicacao-pdca.qmd
        - chapters/part1-04-resumo.qmd
        - chapters/part1-05-exercicios.qmd

    - part: "Fundamento da Gestão da Manutenção"
      chapters:
        - chapters/part2-09-o-que-e-manutencao.qmd
        - chapters/part2-10-o-que-e-gestao-manutencao.qmd
        - chapters/part2-11-planejamento-controle-manutencao.qmd
        - chapters/part2-12-placeholder.qmd

    - summary.qmd
    - references.qmd

## bibliography: references.bib
lang: pt-BR
language:
  pt-BR:
    fig: "Figura"
    figures: "Figuras"
    table: "Tabela"
    tables: "Tabelas"

format:
  html:
    theme:
      light: flatly
      dark: darkly
    css: styles-clean.css
    code-fold: true
    code-tools: true
    toc: true
    toc-location: right
    toc-depth: 3
    number-sections: true
    link-external-newwindow: true
    include-after-body:
      - text: |
          <footer id="quarto-footer">
            <div class="footer-content">
              <div class="footer-left">
                "Confiabilidade e Manutenção" foi escrito por <a href="#">Rafael da Silva Fernandes</a>.
              </div>
              <div class="footer-right">
                Este livro foi construído com o pacote <a href="https://quarto.org" target="_blank">Quarto</a>.
              </div>
            </div>
          </footer>
      - text: |
          <!-- Força carregamento final do CSS e regra específica do TOC -->
          <link rel="stylesheet" href="/styles-clean.css">
          <style>
          /* Regra final aplicada no fim do body para garantir prioridade */
          #TOC ul > li > a.active,
          #TOC ul > li.active > a,
          #TOC .active,
          #TOC li.active > a {
            font-weight: bold !important;
            color: #ffffff !important;
            border-left: 4px solid #d4af37 !important;
            background: var(--color-teal-dark) !important;
            background-color: var(--color-teal-dark) !important;
            border-color: #d4af37 !important;
            box-shadow: none !important;
            padding-left: 0.8rem !important;
            outline: none !important;
          }
          </style>
          <script>
          // Força estilos inline nos itens ativos do TOC (maior prioridade que qualquer CSS)
          (function(){
            function forceTOC() {
              try {
                var els = document.querySelectorAll('#TOC .nav-link.active, #TOC li.active > a');
                els.forEach(function(el){
                  el.setAttribute('style', 'font-weight: bold !important; color: #ffffff !important; background: var(--color-teal-dark) !important; border-left: 4px solid #d4af37 !important; padding-left: 0.8rem !important; box-shadow: none !important;');
                });
              } catch(e){ console.warn('forceTOC error', e); }
            }
            if (document.readyState === 'complete' || document.readyState === 'interactive') {
              setTimeout(forceTOC, 10);
            } else {
              document.addEventListener('DOMContentLoaded', function(){ setTimeout(forceTOC, 10); });
            }
            // Também reaplica ao clicar em links (quando a TOC muda por JS)
            document.addEventListener('click', function(){ setTimeout(forceTOC, 50); }, true);
          })();
          </script>
          <script>
          // Remove linhas e reduz espaçamento em TODOS os itens do TOC via inline styles
          (function(){
            function normalizeTOC(){
              try{
                var lis = document.querySelectorAll('#TOC ul > li');
                lis.forEach(function(li){
                  li.style.borderBottom = '0';
                  li.style.marginBottom = '0';
                  li.style.paddingBottom = '0';
                });
                var links = document.querySelectorAll('#TOC ul > li > a, #TOC a');
                links.forEach(function(a){
                  a.style.paddingTop = '0.18rem';
                  a.style.paddingBottom = '0.18rem';
                  a.style.paddingLeft = '0.6rem';
                  a.style.borderBottom = '0';
                });
              }catch(e){console.warn('normalizeTOC error', e)}
            }
            if (document.readyState === 'complete' || document.readyState === 'interactive') {
              setTimeout(normalizeTOC, 10);
            } else {
              document.addEventListener('DOMContentLoaded', function(){ setTimeout(normalizeTOC, 10); });
            }
            document.addEventListener('click', function(){ setTimeout(normalizeTOC, 50); }, true);
          })();
          </script>
    include-in-header:
      - text: |
          <style>
          #TOC ul > li > a.active,
          #TOC ul > li.active > a,
          #TOC .active,
          #TOC li.active > a {
            font-weight: bold !important;
            color: #d4af37 !important;
            border-left: 4px solid #d4af37 !important;
            background: transparent !important;
            background-color: transparent !important;
            border-color: #d4af37 !important;
            box-shadow: none !important;
            padding-left: 0.8rem !important;
            outline: none !important;
          }
          </style>
          <script>
          document.addEventListener('DOMContentLoaded', function() {
            const header = document.getElementById('quarto-header');
            if (header) {
              header.innerHTML = `
                <div class="navbar-container">
                  <div class="quarto-navbar-tools quarto-navbar-tools-start">
                    <div class="dropdown" id="format-menu">
                      <button class="dropdown-toggle" title="Opções de formatação" aria-label="Formatação"><i class="bi bi-gear"></i></button>
                      <div class="dropdown-content">
                        <div class="format-option">
                          <label>Fonte</label>
                          <button data-font="serif" class="format-btn">A<span class="font-label">Serif</span></button>
                          <button data-font="sans" class="format-btn">A<span class="font-label">Sans</span></button>
                        </div>
                        <div class="format-option">
                          <label>Tema</label>
                          <button data-theme="white" class="format-btn theme-btn">White</button>
                          <button data-theme="sepia" class="format-btn theme-btn">Sepia</button>
                          <button data-theme="night" class="format-btn theme-btn">Night</button>
                        </div>
                        <div class="format-option">
                          <label>Espaçamento</label>
                          <button data-spacing="minus" class="format-btn spacing-btn">Spacing -</button>
                          <button data-spacing="plus" class="format-btn spacing-btn">Spacing +</button>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="navbar-title">Confiabilidade e Manutenção: Aplicações em R<span class="edicao"> 1ª ed.</span></div>
                  <div class="quarto-navbar-tools quarto-navbar-tools-end">
                    <a href="https://twitter.com" target="_blank" title="Twitter" aria-label="Twitter"><i class="bi bi-twitter"></i></a>
                    <a href="https://facebook.com" target="_blank" title="Facebook" aria-label="Facebook"><i class="bi bi-facebook"></i></a>
                    <a href="#" title="Compartilhar" aria-label="Compartilhar"><i class="bi bi-share"></i></a>
                  </div>
                </div>
              `;

              // Format Menu Dropdown - com timeout para garantir que elementos existam
              setTimeout(function() {
                const formatBtn = document.querySelector('#format-menu .dropdown-toggle');
                const formatContent = document.querySelector('#format-menu .dropdown-content');

                if (formatBtn && formatContent) {
                  formatBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const isVisible = formatContent.style.display === 'block';
                    formatContent.style.display = isVisible ? 'none' : 'block';
                  });

                  document.addEventListener('click', function(e) {
                    if (!e.target.closest('#format-menu')) {
                      formatContent.style.display = 'none';
                    }
                  });
                }
              }, 100);

              // Font change
              document.querySelectorAll('[data-font]').forEach(btn => {
                btn.addEventListener('click', function() {
                  document.querySelectorAll('[data-font]').forEach(b => b.classList.remove('active'));
                  this.classList.add('active');
                  document.body.style.fontFamily = this.dataset.font === 'serif' ?
                    "'Times New Roman', Times, serif" :
                    "Arial, Helvetica, sans-serif";
                });
              });

              // Theme change with sidebar and TOC
              document.querySelectorAll('[data-theme]').forEach(btn => {
                btn.addEventListener('click', function() {
                  document.querySelectorAll('[data-theme]').forEach(b => b.classList.remove('active'));
                  this.classList.add('active');

                  const theme = this.dataset.theme;
                  const sidebar = document.getElementById('quarto-sidebar');
                  const toc = document.getElementById('quarto-margin-sidebar');

                  document.body.classList.remove('theme-white', 'theme-sepia', 'theme-night');
                  document.body.classList.add('theme-' + theme);

                  if (theme === 'night') {
                    if (sidebar) sidebar.style.background = '#1e1e1e';
                    if (toc) toc.style.background = '#2d2d2d';
                  } else if (theme === 'sepia') {
                    if (sidebar) sidebar.style.background = '#5b4636';
                    if (toc) toc.style.background = '#e8dcc8';
                  } else {
                    if (sidebar) sidebar.style.background = '';
                    if (toc) toc.style.background = '';
                  }
                });
              });

              // Spacing change
              document.querySelectorAll('[data-spacing]').forEach(btn => {
                btn.addEventListener('click', function() {
                  const content = document.querySelector('main.content');
                  if (content) {
                    const currentSize = parseFloat(window.getComputedStyle(content).fontSize);
                    const newSize = this.dataset.spacing === 'plus' ? currentSize + 1 : currentSize - 1;
                    content.style.fontSize = newSize + 'px';
                  }
                });
              });
            }
          });
          </script>
  pdf:
    documentclass: book
    geometry:
      - top=3cm
      - bottom=2cm
      - left=3cm
      - right=2cm
    fontfamily: mathptmx
    fontsize: 12pt
    linestretch: 1.5
    indent: true
    number-sections: true
    toc: true
    toc-depth: 3

execute:
  echo: true
  warning: false
  message: false
  cache: true
  freeze: auto

editor: source
